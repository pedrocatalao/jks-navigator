#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_DIR="${ROOT_DIR}/.venv"
VENV_PY="${VENV_DIR}/bin/python"

if ! command -v python3 >/dev/null 2>&1; then
  echo "jksnav-tui bootstrap error: python3 is required but was not found in PATH" >&2
  exit 1
fi

if [[ ! -x "${VENV_PY}" ]]; then
  python3 -m venv "${VENV_DIR}"
fi

if ! "${VENV_PY}" -c "import cryptography" >/dev/null 2>&1; then
  if ! "${VENV_PY}" -m pip install cryptography >/dev/null; then
    echo "jksnav-tui bootstrap error: failed to install required dependency 'cryptography'." >&2
    echo "Check network/PyPI access, then run ./jksnav-tui again." >&2
    exit 1
  fi
fi

exec env PYTHONPATH="${ROOT_DIR}/src" "${VENV_PY}" -m jksnav.tui "$@"
